# 操作系统

> 比较重要的点：
>
> * 系统调用是什么，常用的系统调用算法（5个）
> * 死锁 **(这部分可以看juc部分)** ，产生死锁的4个条件，如何预防（破坏条件）、避免（Dij）、检测（图）、解除死锁
> * 分页、分段、常见的页面置换算法

## 用户态与内核态

* 用户态：应用程序、库函数、系统调用接口、辅助工具（如文本编辑器）
* 内核态：进程管理、内存管理、设备管理、文件管理、网络管理。。

## 用户态和内核态是如何切换的？

* 系统调用：用户态主动要求切换到内核态
* 中断：向CPU发送信号，请求CPU的处理
* 异常：发现不可知的一场，比如说缺页异常

## 系统调用

### 系统调用

* 系统调用是应用程序与操作系统之间进行交互的一种方式，通过系统调用，应用程序可以访问操作系统底层资源例如文件、设备、网络等。

### 进程的调度算法

* **先到先服务调度算法**
* **短作业优先调度算法**
* **时间片轮转调度算法**
* **多级反馈队列调度算法**
* **优先级调度算法**

## 死锁

* 多个进程/线程同时被阻塞，它们中的一个或者全部都在等待某个资源被释放。由于进程/线程被无限期地阻塞，因此程序不可能正常终止。

### 产生死锁的四个必要条件

* **互斥**
* **占有并等待**
* **非抢占**
* **循环等待**

### 解决死锁的方法

* 预防：限制并发进程对资源的请求
* 避免：提前做出预测，避免死锁的发生
* 检测：专门的机构
* 解除：将进程从死锁状态下解脱出来

### 死锁的预防

* 破坏任意一个条件就能够预防死锁的发生
  * 互斥条件：很多资源往往是不能同时访问的
  * 非抢占：可以采用剥夺式调度算法，一般仅适用于主存资源和处理器资源，其他资源会导致资源利用率下降
* 静态分配资源：破坏第二个条件（占有并等待）：一个进程必须申请到全部资源。
  * 严重降低了资源的利用率
  * 占有一些几乎不用的资源而使其他需要改资源的进程产生等待的情况
* 层次分配策略：破坏第四个条件（循环等待）
  * 所有进程被分成了多个层次，一个资源得到每一层的一个资源后，它只能在申请较高一层的资源，释放资源也要先释放较高层的资源，不会出现循环等待。

### 死锁的避免

* 预防：预防会导致低效的进程运行和资源利用率
* 避免：允许系统中同时存在四个必要条件
* 动态申请
* Dijkstra的银行家算法

### 死锁的检测

* 预防和避免：不利于资源的充分共享
* 进程-资源分配图

### 死锁的解除

* 立即结束所有进程的执行，重新启动操作系统
* 撤销涉及死锁的所有进程，解除死锁后继续运行
* 逐个撤销涉及死锁的进程，回收其资源直至死锁解除
* 抢占资源

### Java中的死锁

* **jps**：输出JVM中运行的进程状态信息（如果发生死锁会显示：Deadlock）
* **jstack**：查看java进程内线程的堆栈信息（使用jstack -l 46032）（可以看到线程等待的锁和已拥有的锁）（Found 1 deadlock)
* **jconsole**
* **VisualVM**

## 内存管理

### 虚拟内存

* 隔离进程：物理内存通过虚拟地址空间访问，虚拟地址空间与进程一一对应。一个进程的代码无法更改正在由另一个进程或操作系统使用的物理内存。
* 提升物理内存利用率：只需要将当前正在使用的部分数据或指令加载入物理内存。
* 简化内存管理：不用和真正的内存打交道。
* 多个进程共享物理内存：加载操作系统的动态库只用加载一份。
* 提高内存使用安全性：隔离不同进程的访问权限，提高系统的安全性。
* 提供更大的可使用内存空间：物理内存不够，可以使用磁盘充当。

### 分段机制

* 分段机制：以段（一段连续的物理内存）的形式管理/分配物理内存。应用程序的虚拟地址空间被分为大小不等的段，段是有实际意义的，每个段定义了一组逻辑信息，例如有主程序段MAIN、子程序段X、数据段D及栈段S等。
![image.png](https://s2.loli.net/2024/04/21/wFR4dnWA2gjIx6Q.png)
* 段表被删除、段表还没有创建

### 分页机制

* 分页机制：把主存（物理内存）分为连续等长的物理页，应用程序的虚拟地址空间也被分为连续等长的虚拟页。
![image-1.png](https://s2.loli.net/2024/04/21/ZH3l2sOwik9hoQE.png)
* 二级页表：页表开销大，绝大部分应用程序可能只能用到页表中的几项，其他的白白浪费了。
* 多级页表：比如二级列表分为一级页表和二级页表。

### TLB

* 内部存储单元实际上是一块高速缓存Cache

### 页缺失

* 硬件页缺失：物理内存中没有对应的物理页
* 软件页缺失：物理内存中有对应的物理页，但虚拟页还未和物理页建立映射。

### 常见的页面置换算法

* 先进先出页面置换算法FIFO
* 最佳页面置换算法OPT：理论最优
* 时钟页面置换算法Clock
* 最少使用页面置换算法LFU
* 最近最久未使用页面置换算法LRU（当说到LRU和LFU的时候，我认为可以提一下redis的淘汰策略）

## 常见磁盘调度算法（不会考）

![image-2.png](https://s2.loli.net/2024/04/21/CvoeG1By4NzOiRg.png)